<!doctype html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Witch.js</title>

    <link rel="stylesheet" href="components/bootstrap/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="components/prism/prism-okaidia.css"/>
    <link rel="stylesheet" href="css/main.css"/>

    <!-- Notice it is usually much better to put scripts at the end of <body>,
         but because of all the inline <script>s in this page, i put these here. -->
    <script src="components/jquery/jquery.min.js"></script>
    <script src="dist/witch-dep.min.js"></script>
</head>
<body>

<div>
    <header>
        <aside>
            <a href="https://github.com/eyy/witch">
                Github
                <span class="brandico-github"></span>
            </a>
            <a href="http://empeeric.com">
                Empeeric
                <img src="img/empeeric.png" alt=""/>
            </a>
        </aside>
        <h1>
            <a href="https://github.com/eyy/witch">Witch.js</a>
            <img src="img/icon.png" alt="" />
        </h1>
        <p>Against monster-frameworks and unnatural coding practices, you might need a <strong>witch</strong> at your side.</p>
    </header>

    <!-- <h3 class="pull-right">Only 2kb (7kb with dependencies)!</h3> -->

    <h2>The Basic</h2>
    <p>Data binding with <a href="http://rivetsjs.com">Rivets</a>, object observer with <a href="https://github.com/melanke/Watch.JS">Watch.js</a></p>
    <div class="row">
        <div class="span3">
            <h3>Output</h3>
            <div class="html">
            <div data-rivets="simple">
                <p>
                    <!-- One-way binding -->
                    <strong data-text="model.text"></strong>
                    is probably
                </p>
                <!-- Two-way binding -->
                <input type="text" data-value="model.text"/>
                <span data-text="model.deep.nested"></span>
            </div>
            </div>
        </div>
        <script>
            // Write clean, sane javascript
            var simple = {
                model: {
                    text: 'Hi there!',
                    deep: {
                        nested: '(yeah.)'
                    }
                }
            };
        </script>
    </div>
    <hr>

    <h2>Still Quite Basic</h2>
    <p>Models, collections and computed properties</p>
    <div class="row">
        <div class="span3">
            <h3>Todo</h3>
            <div class="html">
            <style type="text/css">
                .done {
                    text-decoration: line-through;
                    color: grey;
                }
            </style>

            <div data-rivets="todo">
                <p>
                    <!-- Declare computed property dependencies -->
                    <span data-text="tasks:remaining
                        < .list.length .updated"></span> of
                    <span data-text="tasks.list.length"></span> remaining
                </p>
                <ul>
                    <!-- Loop through the collection  -->
                    <li data-each-task="tasks.list" data-class-done="task.done">
                        <input type="checkbox" data-checked="task.done" />
                        <span data-text="task.text"></span>
                    </li>
                </ul>
                <form data-on-submit="tsk:saveAs">
                    <input type="text" data-value="tsk.text"/>
                    <button type="submit" class="btn">Add task</button>
                </form>
            </div>
            </div>
        </div>
        <script>
            // Write and inherit classes however you like
            var Task = function() {
                witch.Model.apply(this, arguments);
                // Notifying the change
                watch(this, 'done', function() {
                    this._collection.updated += 'a';
                });
            };
            $.extend(Task.prototype, witch.Model.prototype);

            // Our task collection
            var tasks = new witch.Collection([
                { done: true, text: 'Buy a toad' },
                { done: false, text: 'Buy a bat' },
                { done: false, text: 'Fix my broom' }
            ], Task); // <-- is a collection of tasks

            // A computed property
            tasks.remaining = function() {
                return this.list.filter(function(t) {
                    return !t.done
                }).length;
            };

            var todo = {
                tasks: tasks,
                tsk: new Task({}, tasks)
            };
        </script>
    </div>
    <hr>

    <h2>Basic All The Way Down</h2>
    <p>Templates, simple as they should be.</p>
    <div class="row">
        <div class="span4">
            <h3>Which Witch?</h3>
            <div class="html">
            <div data-rivets="temp">
                <ul>
                    <li data-each-user="users.list">
                        <a href="#" data-text="user.name" data-on-click="user:card"></a>
                    </li>
                </ul>
                <div class="cards"></div>
            </div>

            <!-- A template markup. -->
            <div data-template="user-card">
                <div class="user-card">
                    <a class="close" href="#" data-on-click="tpl:close">x</a>
                    <strong data-text="user.name"></strong>
                </div>
            </div>
            </div>
        </div>
        <script>
            // Create your template
            var UserCard = witch.inherit(witch.Template, {
                template: 'user-card',
                ready: function() {
                    this.el.appendTo('.cards');
                },
                close: function() {
                    this.el.remove();
                }
            });

            var User = witch.inherit(witch.Model, {
                card: function() {
                    // Use it
                    var card = new UserCard({ user: this });
                    card.render();
                }
            });

            var users = new witch.Collection([
                { name: 'Morgan Le Fay' },
                { name: 'Maggie Wall' },
                { name: 'Medea' }
            ], User);

            var temp = {
                users: users
            };

            $(function() {
                users.list[0].card();
            });
        </script>
    </div>
    <hr>

    <h2>... And Basically, All The Way Up As Well</h2>
    <p>
        REST assure: you can fetch and save your data from/to the server. Also, a little animation example.<br />
        <span class="label label-info">For this example to talk with a server, we need a server. If you have git, node and mongo, you can run one:</span>
    </p>
    <pre style="width:500px;"><code>git clone https://git@github.com/eyy/witch.git -b gh-pages
cd witch
npm install
node app</code></pre>
    <div class="row">
        <div class="span3">
            <h3>REST</h3>
            <div class="html">
            <style type="text/css">
                .flash { -webkit-animation: 2s flash; }
                @-webkit-keyframes flash {
                    from { background: yellow; }
                    to { background: auto; }
                }
            </style>

            <div data-rivets="server">
                <ul>
                    <!-- Add a nice flash animation when adding items -->
                    <li data-each-item="items.list" data-class-flash="item._new">
                        <!-- `delete()` -->
                        <i class="icon-remove" data-on-click="item:delete"></i>
                        <span data-text="item.name"></span>
                    </li>
                </ul>
                <!-- `saveAs()` will clone the data and clean itself -->
                <form data-on-submit="item:saveAs">
                    <input type="text" data-value="item.name"/>
                    <button class="btn">Add Item</button>
                </form>
            </div>
            </div>
        </div>
        <script>
            var items = new witch.Collection([
                // Fake data, pretend it's from the server
                { name: 'Spell book' },
                { name: 'Broom' },
            ], '/api/items/'); // <-- collection url

            var server = {
                items: items,
                item: new witch.Model({}, items) // <-- model's collection
            };

            $(function() {
                // Fetch 'em!
                items.fetch();
            });
        </script>
    </div>
</div>

<div data-template="code">
    <div class="span7">
        <h3>HTML</h3>
        <pre><code class="language-markup"></code></pre>
    </div>
    <div class="span6">
        <h3>Javascript</h3>
        <pre><code class="language-javascript"></code></pre>
    </div>
</div>

<script>
    var cleanTabs = function(s) {
        return s.replace(/^[ ]{12}/mg, '');
    };

    $('.row').each(function() {
        var t = $(this),
            html = cleanTabs(t.find('.html').html().trim()),
            script = cleanTabs(t.find('script').text().trim());
        witch.config.template('code', function(err, el) {
            t.prepend(el);
            el.find('code.language-markup').text(html);
            el.find('code.language-javascript').text(script);
        });
    });
</script>
<script src="components/prism/prism.js"></script>

</body>
</html>
